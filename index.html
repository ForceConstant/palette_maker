<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palette Maker</title>
    <style>
        .color-patch {
            width: 50px;
            height: 50px;
            display: inline-block;
            border: 1px solid #000;
            margin: 5px;
        }

        #palette {
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <!-- Color Patches -->
    <p> Base Colors </p>
    <input type="color" id="color1" value="#ff0000">
    <div class="color-patch" id="patch1" style="background-color: #ff0000"></div>
    <input type="color" id="color2" value="#00ff00">
    <div class="color-patch" id="patch2" style="background-color: #00ff00"></div>
    <input type="color" id="color3" value="#0000ff">
    <div class="color-patch" id="patch3" style="background-color: #0000ff"></div>
    <input type="color" id="color4" value="#ffff00">
    <div class="color-patch" id="patch4" style="background-color: #ffff00"></div>

    <p>Generated Palette</p>
    <!-- Canvas for Palette -->
    <canvas id="palette" width="1100" height="50"></canvas>
    <p></p>
    <button id="savePaletteBtn">Save Palette</button>

    <pre id="gplCodeDisplay"></pre>

    <script>
        // Get elements
        const color1Input = document.getElementById('color1');
        const color2Input = document.getElementById('color2');
        const color3Input = document.getElementById('color3');
        const color4Input = document.getElementById('color4');
        const patch1 = document.getElementById('patch1');
        const patch2 = document.getElementById('patch2');
        const patch3 = document.getElementById('patch3');
        const patch4 = document.getElementById('patch4');
        const paletteCanvas = document.getElementById('palette');
        const ctx = paletteCanvas.getContext('2d');
        const num_dark_shades = 2;
        const num_light_shades = 2;

        // Add event listeners to color patches
        patch1.addEventListener('click', () => color1Input.click());
        patch2.addEventListener('click', () => color2Input.click());
        patch3.addEventListener('click', () => color3Input.click());
        patch4.addEventListener('click', () => color4Input.click());

        // Update color patches on color change
        color1Input.addEventListener('input', () => patch1.style.backgroundColor = color1Input.value);
        color2Input.addEventListener('input', () => patch2.style.backgroundColor = color2Input.value);
        color3Input.addEventListener('input', () => patch3.style.backgroundColor = color3Input.value);
        color4Input.addEventListener('input', () => patch4.style.backgroundColor = color4Input.value);

        // Function to generate lighter shades of a color
        function lighterShades(color, amount) {
            const shades = [];
            for (let i = 1; i <= num_light_shades; i++) {
                shades.push(lightenColor(color, amount * i));
            }
            return shades;
        }

        // Function to generate darker shades of a color
        function darkerShades(color, amount) {
            const shades = [];
            for (let i = num_dark_shades; i >= 1; i--) {
                shades.push(darkenColor(color, amount * i));
            }
            return shades;
        }

        // Function to lighten a color
        function lightenColor(color, amount) {
            let rgb = hexToRgb(color);

            // Calculate the new RGB values
            rgb.r = Math.min(255, Math.floor(rgb.r + (255 - rgb.r) * amount));
            rgb.g = Math.min(255, Math.floor(rgb.g + (255 - rgb.g) * amount));
            rgb.b = Math.min(255, Math.floor(rgb.b + (255 - rgb.b) * amount));

            return rgbToHex(rgb);
        }

        // Function to darken a color
        function darkenColor(color, amount) {
            let rgb = hexToRgb(color);

            // Calculate the new RGB values
            rgb.r = Math.max(0, Math.floor(rgb.r * (1 - amount)));
            rgb.g = Math.max(0, Math.floor(rgb.g * (1 - amount)));
            rgb.b = Math.max(0, Math.floor(rgb.b * (1 - amount)));

            return rgbToHex(rgb);
        }

        // Helper function to convert hex to RGB
        function hexToRgb(hex) {
            // Remove the '#' if present
            hex = hex.replace(/^#/, '');
            // Parse the r, g, b values
            let bigint = parseInt(hex, 16);
            return {
                r: (bigint >> 16) & 255,
                g: (bigint >> 8) & 255,
                b: bigint & 255
            };
        }

        // Helper function to convert RGB to hex
        function rgbToHex(rgb) {
            return '#' + ((1 << 24) + (rgb.r << 16) + (rgb.g << 8) + rgb.b).toString(16).slice(1).toUpperCase();
        }


        // Draw palette on page load
        drawPalette();
        updateGPLDisplay();

        // Update palette on color change
        color1Input.addEventListener('input', () => {
            drawPalette();
            updateGPLDisplay();
        });
        color2Input.addEventListener('input', () => {
            drawPalette();
            updateGPLDisplay();
        });
        color3Input.addEventListener('input', () => {
            drawPalette();
            updateGPLDisplay();
        });
        color4Input.addEventListener('input', () => {
            drawPalette();
            updateGPLDisplay();
        });

        function drawPalette() {
            ctx.clearRect(0, 0, paletteCanvas.width, paletteCanvas.height);
            let x = 0;
            let amount = .25;
            const colors = [color1Input.value, color2Input.value, color3Input.value, color4Input.value];
            for (const color of colors) {
                const darkShades = darkerShades(color, amount);
                const lightShades = lighterShades(color, amount);

                for (const shade of darkShades) {
                    ctx.fillStyle = shade;
                    ctx.fillRect(x, 0, 50, 50);
                    x += 50;
                }

                ctx.fillStyle = color;
                ctx.fillRect(x, 0, 50, 50);
                x += 50;

                for (const shade of lightShades) {
                    ctx.fillStyle = shade;
                    ctx.fillRect(x, 0, 50, 50);
                    x += 50;
                }
            }
            ctx.fillStyle = "#000000";
            ctx.fillRect(x, 0, 50, 50);

            x += 50;
            ctx.fillStyle = "#FFFFFF";
            ctx.fillRect(x, 0, 50, 50);
        }

        function generateGPL(colors) {
            let gpl = "GIMP Palette\n";
            gpl += "Name: Custom Palette\n";
            gpl += "#\n";
            colors.forEach(color => {
                const darkShades = darkerShades(color, 0.25);
                const lightShades = lighterShades(color, 0.25);

                darkShades.forEach(shade => {
                    let shadeRgb = hexToRgb(shade);
                    gpl += `${shadeRgb.r} ${shadeRgb.g} ${shadeRgb.b} Untitled\n`;
                });

                let rgb = hexToRgb(color);
                gpl += `${rgb.r} ${rgb.g} ${rgb.b} Untitled\n`;

                lightShades.forEach(shade => {
                    let shadeRgb = hexToRgb(shade);
                    gpl += `${shadeRgb.r} ${shadeRgb.g} ${shadeRgb.b} Untitled\n`;
                });
            });
            // Add black and white colors
            gpl += "0 0 0 Black\n";
            gpl += "255 255 255 White\n";
            return gpl;
        }

        // Function to download the GPL palette file
        function downloadGPL(gpl) {
            const blob = new Blob([gpl], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'palette.gpl';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Event listener for the save button
        document.getElementById('savePaletteBtn').addEventListener('click', () => {
            const colors = [color1Input.value, color2Input.value, color3Input.value, color4Input.value];
            const gpl = generateGPL(colors);
            downloadGPL(gpl);
        });

        function updateGPLDisplay() {
            const colors = [color1Input.value, color2Input.value, color3Input.value, color4Input.value];
            const gpl = generateGPL(colors);
            document.getElementById('gplCodeDisplay').textContent = gpl;
        }
    </script>
</body>

</html>